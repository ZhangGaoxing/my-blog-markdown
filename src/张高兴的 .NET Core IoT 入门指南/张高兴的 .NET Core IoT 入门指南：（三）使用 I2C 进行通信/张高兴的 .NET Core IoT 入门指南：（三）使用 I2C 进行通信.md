<link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

## 什么是 I<sup>2</sup>C 总线

I<sup>2</sup>C 总线（Inter-Integrated Circuit Bus）是设备与设备间通信方式的一种。它是一种串行通信总线，由飞利浦公司在1980年代为了让主板、嵌入式系统或手机用以连接低速周边设备而发展<sup>[[1]](https://baike.baidu.com/item/iic/3524834)</sup>。I<sup>2</sup>C 总线包含两根信号线，一根为信号线 SDA ，另一根为时钟线 SCL 。总线上可以挂载多个设备，以 7 位 I<sup>2</sup>C 地址为例，总线上最多可以挂载 2<sup>7</sup> - 1 个设备，即 127 个，地址 0x00 不用（类似于网络中的广播地址）。I<sup>2</sup>C 还包括一个子集叫 SMBus （System Management Bus），是 1995 年由 Intel 提出的<sup>[[2]](https://baike.baidu.com/item/SMBus/1190006)</sup>。为什么说是子集，是因为 SMBus 是 I<sup>2</sup>C 的简化版，电气特性和传输速率等方面上略有不同。下图展示了一个 I<sup>2</sup>C 主设备和三个 I<sup>2</sup>C 从设备的示意图，总线上只能有一个主设备，而通常情况下你的主机（如 Raspberry Pi，Arduino）就是主设备，传感器为从设备。

![](https://blogres.zhangyue.xin/2019127/2019127155158.png)
<p style="text-align:center;margin-bottom:25px;color:gray"><small>图源：<a href="https://zh.wikipedia.org/wiki/File:I2C.svg">Wikipedia</a></small></p>

<div style="display: block;position: relative;border-radius: 8px;padding: 1rem;background-color: #fff1cc;color: #664b00;margin: 10px">
    <p style="margin-top:0;font-weight: bold"><i class="fa fa-exclamation-triangle" aria-hidden="true"></i>&nbsp;&nbsp;注意</p>
    <p>System.Device.Gpio 目前并不支持 I<sup>2</sup>C Repeated，I2cDevice 类尚未提供 WriteRead() 方法，部分设备可能无法正常通信。</p>
    <p>Issue：<a href="https://github.com/dotnet/iot/issues/129">I2C API should support Restart/Repeat condition #129</a></p>
</div>

I<sup>2</sup>C 总线也并不是那么完美。因为 I<sup>2</sup>C 只有两根信号线，与 SPI 的四根信号线相比，传输速率上并不占优，而且数据在同一时间内只能向一个方向传输。但反过来看，I<sup>2</sup>C 总线的最大优点是只需要占用两个 IO 接口，在单片机等 IO 接口数量较少的设备上也算是一种优势吧。

在 Raspberry Pi 的引脚中，引出了一组 I<sup>2</sup>C 接口，其内部总线 ID 为 1，引脚中的 GPIO 2 为 SDA，GPIO 3 为 SCL（如下图所示）。至于 I<sup>2</sup>C-0，它用于 Raspberry Pi 内部的 GPIO 扩展器、相机、显示器等其他设备。Raspberry Pi 的 I<sup>2</sup>C 引脚中内置了一个 1.8 kΩ 的上拉电阻，这意味着在使用 I<sup>2</sup>C 总线时不必再连接一个额外的上拉电阻。

![](https://blogres.zhangyue.xin/2019127/2019127155158.png)
<p style="text-align:center;margin-bottom:25px;color:gray"><small>Raspberry Pi B+/2B/3B/3B+/Zero 引脚图</small></p>

## 相关类

I<sup>2</sup>C 操作的相关类位于 **System.Device.I2c** 和 **System.Device.I2c.Drivers** 命名空间下。

### I2cConnectionSettings

```C#
public sealed class I2cConnectionSettings
{
    public I2cConnectionSettings(int busId, int deviceAddress);

    public int BusId { get; }
    public int DeviceAddress { get; }
}
```

### UnixI2cDevice 和 Windows10I2cDevice

```C#
public class UnixI2cDevice : I2cDevice
{
    public UnixI2cDevice(I2cConnectionSettings settings);

    public override void Read(Span<byte> buffer);
    public override byte ReadByte();
    public override void Write(ReadOnlySpan<byte> data);
    public override void WriteByte(byte data);
}
```

## 温湿度传感器读取实验